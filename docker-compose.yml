services:
  backend:
    build:
      context: ./apps/backend
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "${BACKEND_PORT:-6008}:${BACKEND_PORT:-6008}"
    env_file:
      - ./.env
      - ./apps/backend/.env
    environment:
      PORT: "${BACKEND_PORT:-6008}"
    command: sh -c "npm run migrate:deploy && npm run dev"

  frontend:
    build:
      context: ./apps/frontend
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      PORT: "${FRONTEND_PORT:-6009}"
      VITE_API_URL: "http://localhost:${BACKEND_PORT:-6008}/api"
      VITE_ALLOWED_HOSTS: "${VITE_ALLOWED_HOSTS:-play.dodon.in,localhost,192.168.1.3}"
    ports:
      - "${FRONTEND_PORT:-6009}:${FRONTEND_PORT:-6009}"
    depends_on:
      - backend
